---
title: "The Birds of Corhaven"
author: "Evelyn Yarzebinski & Kevin Soo"
output: officedown::rdocx_document
  # html_document: default
  # word_document: default
---
```{r message=FALSE, echo=FALSE}
# Load libraries
library(tidyverse)
library(glue)
library(officer)
library(officedown)

# Load data
df <- read_csv("tmp/corhaven_unique_birds_season_2022-02-08.csv") |> 
  select(-url, -photo, -description, -percent) |> 
  mutate(typicalSeason = as_factor(typicalSeason) |> 
           fct_relevel("Advent", "Christmas", "Epiphany", "Lent", "Easter", "Ordinary Time")) |> 
  group_by(birdFamily, comName, speciesCode) |> 
  summarize(typicalSeason = str_c(typicalSeason, collapse = ", "))
ebird <- read_csv("ebird_data.csv") |> 
  mutate(photo_path = glue("photos/{speciesCode}.png"))

# Get bird families
fam <- ebird |> 
  pull(birdFamily) |> 
  unique()

# Join dataframes
df <- df |> 
  left_join(ebird) 
```



```{r echo=FALSE, results='asis'}
fam_template <- "## %s

"

species_template <- "### %s
<!---BLOCK_MULTICOL_START--->

%s

`r run_columnbreak()`
*Typical seasons: %s*

![alt text here](%s){width=25%%}
<!---BLOCK_MULTICOL_STOP--->
"

# for (i in seq(nrow(input))) {
#   current <- input[i, ]
#   cat(sprintf(template, current$name, current$data, current$text))
# }

for (i in fam) {
    
    # Get current bird family
    fam_current <- i
    
    # Get all species within bird family
    fam_species <- df |>
        filter(birdFamily == fam_current)
    
    # Print bird family section header
    cat(sprintf(fam_template, fam_current))
    
    # For all species within family, print an entry
    for (j in 1:nrow(fam_species)) {
        cat(sprintf(species_template, 
                    fam_species$comName[j], 
                    fam_species$description[j],
                    fam_species$typicalSeason[j],
                    fam_species$photo_path[j]
                    )
            )
    }
}
```